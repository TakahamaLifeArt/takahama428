/**
 * ScrollPagination jQuery plugin
 * Scroll to load the content asynchronously.
 * @author (c) 2018 ks.desk@gmail.com
 */
(function(b){function c(a,b){this.element_=a;this.opts_=b;this.init()}b.fn.ScrollPagination=function(a){var g=b.extend(!0,b.fn.ScrollPagination.defaults,a);return this.each(function(){var a=b(this);a.data("ScrollPagination")||a.data("ScrollPagination",new c(a,g))})};b.fn.ScrollPagination.defaults={offsetPoint:0,stepCount:12,isLoading:!1,isScrolled:!1,isAllContents:!1,bottomLine:0,adjustHeight:200,autoStart:!1};c.prototype.init=function(){b(window).on("resize.showAjax",function(a){a.setBottomPos(a)}.bind(null,
this));b(window).on("scroll.showAjax",function(a){a.opts_.isAllContents||a.showAjaxContents(a)}.bind(null,this));this.opts_.autoStart&&this.showAjaxContents(this)};c.prototype.destroy=function(){return this.element_.each(function(){b(window).off(".showAjax");b(this).removeData("ScrollPagination")})};c.prototype.reset=function(){this.element_.html("");return this.element_.each(function(){b(this).data("ScrollPagination").opts_.offsetPoint=0;b(this).data("ScrollPagination").opts_.isAllContents=!1})};
c.prototype.restart=function(){this.reset();this.showAjaxContents(this)};c.prototype.mbConvert=function(a,b){return"A"==b?String(a).replace(/[A-Za-z0-9]/g,function(a){return String.fromCharCode(a.charCodeAt(0)+65248)}):String(a).replace(/[\uff21-\uff3a\uff41-\uff5a\uff10-\uff19]/g,function(a){return String.fromCharCode(a.charCodeAt(0)-65248)})};c.prototype.setBottomPos=function(a){a.opts_.bottomLine=b(document).height()-b(window).height()-a.opts_.adjustHeight};c.prototype.showAjaxContents=function(a){this.setBottomPos(this);
if(!(a.opts_.isLoading||a.opts_.isAllContents||0<a.opts_.bottomLine-b(document).scrollTop())){var c=""+a.opts_.offsetPoint+"-"+a.opts_.stepCount,h=0!=_IS_TAG?"tag":"category",e=[],f="popular";a.opts_.isLoading=!0;a.element_.append('<div id="ajax-loading" style="padding:2rem; text-align:center;"><img src="/common/img/loading.svg"></div>');b("input:not(.def)","#form_tag_search").each(function(){var a=b(this).val();if(""==a)return!0;e.push(a)});f=b("#sort .act").attr("id").split("_")[2];b.ajax({url:"/php_libs/pageinfo.php",
async:!0,type:"POST",dataType:"text",data:{act:"itemtag",catid:_CAT_ID,tagid:e,mode:h,priceorder:f,limit:c}}).done(function(c){var d=c.split("|");c=a.mbConvert(b(".number").text(),"a")-0;a.element_.append(d[0]);2==d.length&&(d=a.mbConvert(d[1],"a")-0,a.opts_.offsetPoint=d+c,b(".number").text(a.mbConvert(a.opts_.offsetPoint,"A")),d<a.opts_.stepCount&&(a.opts_.isAllContents=!0))}).always(function(){b("#ajax-loading").remove();a.opts_.isLoading=!1})}}})(jQuery);